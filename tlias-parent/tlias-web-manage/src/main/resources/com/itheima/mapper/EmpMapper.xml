<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itheima.mapper.EmpMapper">
    <insert id="insertEmp" useGeneratedKeys="true" keyProperty="id">
        insert into emp values
        (null,#{username},#{password},#{name}, #{gender},#{phone},#{job},#{salary},#{image},#{entryDate},#{deptId},#{createTime},#{updateTime})
    </insert>
    <update id="update">
        update emp
        <set>
            <if test="username != null and username != ''">username = #{username},</if>
            <if test="password != null and password != ''">password = #{password},</if>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="gender != null">gender = #{gender},</if>
            <if test="phone != null and phone != ''">phone = #{phone},</if>
            <if test="job != null">job = #{job},</if>
            <if test="salary != null">salary = #{salary},</if>
            <if test="image != null and image != ''">image = #{image},</if>
            <if test="entryDate != null">entry_date = #{entryDate},</if>
            <if test="deptId != null">dept_id = #{deptId},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </set>
         where id = #{id}

    </update>
    <delete id="deleteBatch">
        delete from emp where id in
        <foreach collection="ids" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>
    <select id="select" resultType="com.itheima.entity.vo.Emp">
        select emp.*,dept.name deptName from emp left join dept on emp.dept_id = dept.id
        <where>
            <if test="name !=null and name !=''"> emp.name like concat('%', #{name}, '%')</if>
            <if test="gender !=null"> and emp.gender = #{gender}</if>
            <if test="begin != null and end != null"> and emp.entry_date between #{begin} and #{end} </if>
        </where>
        order by emp.update_time desc
    </select>

    <resultMap id="empResultMap" type="com.itheima.entity.vo.Emp" autoMapping="true">
        <id column="id" property="id"></id>
        <collection property="exprList" ofType="com.itheima.entity.po.EmpExpr">
            <result column="expr_id" property="id"></result>
            <result column="expr_empId" property="empId"></result>
            <result column="expr_begin" property="begin"></result>
            <result column="expr_end" property="end"></result>
            <result column="expr_job" property="job"></result>
            <result column="expr_company" property="company"></result>
        </collection>
    </resultMap>

    <select id="getById" resultMap="empResultMap">
        select emp.*,
               emp_expr.company expr_company,
               emp_expr.begin expr_begin,
               emp_expr.end expr_end,
               emp_expr.job expr_job,
               emp_expr.id expr_id,
               emp_expr.emp_id expr_empId
        from emp left join emp_expr on emp.id = emp_expr.emp_id
        where emp.id = #{id}
    </select>
    <select id="empJobData" resultType="java.util.Map">
        select (case dept_id
                    when 1 then '学工部'
                    when 2 then '教研部'
                    when 3 then '咨询部'
                    when 4 then '就业部'
                    when 5 then '人事部'
                    when 6 then '行政部'
                    when 7 then '综合部'
                    else '其他'
            end ) as deptId
             ,count(*) cnt from emp group by deptId
    </select>
    <select id="empGenderData" resultType="java.util.Map">
        select if(gender=1,'男性员工','女性员工') name,
               count(*) value from emp group by gender
    </select>
    <select id="selectall" resultType="com.itheima.entity.vo.Emp">
        select * from emp
    </select>
    <select id="loginCheck" resultType="com.itheima.entity.vo.Emp">
        select * from emp where username = #{username} and password = #{password}
    </select>
    <select id="getByDeptId" resultType="java.lang.Integer">
        select count(*) from emp where dept_id = #{id}
    </select>
</mapper>